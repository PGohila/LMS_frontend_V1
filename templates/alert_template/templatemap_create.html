{% extends 'base.html' %}

{% block body_block %}
<body>
    <main id="main" class="main">
        <div class="pagetitle">
            <h1>Template Mapping Form</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item">Forms</li>
                    <li class="breadcrumb-item active">Template Mapping</li>
                </ol>
            </nav>
        </div><!-- End Page Title -->

        <section class="section">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Template Mapping Form</h5>

                            <!-- Form begins -->
                            <form method="post" enctype="multipart/form-data">
                                {% csrf_token %}

                                <!-- Template Rows Container -->
                                <div id="templateRows">
                                    <div class="template-row" id="row_1">
                                        <div class="col-md-3">
                                            <label for="template_name">Template Name</label>
                                            {{ form.template_name }}
                                        </div>
                                        <div class="form-group row">
                                            <!-- Template Type input -->
                                            <div class="col-md-3">
                                                <label for="template_type_1">Template Type</label>
                                                {{ form.template_type }}
                                            </div>
                                 
                                            <!-- Template Select input -->
                                            <div class="col-md-3">
                                                <label for="template_1">Template</label>
                                                <select name="template" id="template" class="form-control">
                                                    {% for template in template_records %}
                                                        <option value="{{ template.id }}">{{ template.template_name }} - {{ template.template_id }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                 
                                            <!-- Add/Remove buttons -->
                                            <div class="col-md-3 text-center">
                                                <button type="button" class="btn btn-success btn-sm" onclick="addRow()">+</button>
                                                <button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">-</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <button type="submit" class="btn btn-success btn-sm">Submit</button>
                                    <button type="reset" class="btn btn-outline-info btn-sm">Reset</button>
                                </div>
                            </form>
                            <!-- Form ends -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main><!-- End #main -->

    <script>
        let rowCount = 1;  // To keep track of the row number dynamically

        // This variable contains the template records that will be used to populate the dropdown dynamically
        const templateRecords = [
            {% for template in template_records %}
                { id: {{ template.id }}, name: "{{ template.template_name }}", template_id: "{{ template.template_id }}" },
            {% endfor %}
        ];

        // Add a new row
        function addRow() {
            rowCount++;  // Increment row count
            const templateRowsContainer = document.getElementById('templateRows');  // Get the container for template rows

            // Create a new row element
            const newRow = document.createElement('div');
            newRow.classList.add('template-row');
            newRow.id = `row_${rowCount}`;

            // Build the options for the template dropdown dynamically from templateRecords
            let templateOptions = '';
            templateRecords.forEach(template => {
                templateOptions += `<option value="${template.id}">${template.name} - ${template.template_id}</option>`;
            });

            // HTML structure for the new row
            newRow.innerHTML = `
                <div class="form-group row">
                    <!-- Template Type input -->
                    <div class="col-md-3">
                        <label for="template_type_${rowCount}">Template Type</label>
                        <select name="template_type" id="template_type_${rowCount}" class="form-control">
                            <option value="SMS">SMS</option>
                            <option value="EMAIL">EMAIL</option>
                            <option value="WHATSAPP">WHATSAPP</option>
                            <option value="PRINTER">PRINTER</option>
                        </select>
                    </div>

                    <!-- Template Select input -->
                    <div class="col-md-3">
                        <label for="template_${rowCount}">Template</label>
                        <select name="template" id="template_${rowCount}" class="form-control">
                            ${templateOptions}
                        </select>
                    </div>

                    <!-- Add/Remove buttons -->
                    <div class="col-md-3 text-center">
                        <button type="button" class="btn btn-success btn-sm" onclick="addRow()">+</button>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">-</button>
                    </div>
                </div>
            `;

            // Append the new row to the container
            templateRowsContainer.appendChild(newRow);
        }

        // Remove a row
        function removeRow(button) {
            const row = button.closest('.template-row');  // Get the closest row to the button clicked
            if (rowCount > 1) {
                row.remove();  // Remove the row
                rowCount--;  // Decrement the row count
            } else {
                alert('You cannot remove the last row.');
            }
        }
    </script>
</body>
{% endblock %}
    